<%= link_to welcome_path, class: "back-button" do %>
  <i class="fas fa-arrow-left"></i>
<% end %>
<h1 class="page-title">BUDDY</h1>
<div class="container">

  <% if @events.length == 0 %>
      <div class="py-3"><p></p></div>
    <h3 class="mt-4 mb-5">No events listed at the location "<%= current_user.search_location %>"... :(</h3>
    <h2 class="mb-3 mt-2">Try again</h2>
    <%= form_for @user, url: root_path, method: :patch do |f| %>
      <%= f.text_field :search_location, placeholder: 'Input another location', value: "", label:false %>
      <%= f.submit '>', class: "btn btn-primary", style: "padding: 2px 6px; margin-bottom: 2px" %>
    <% end %>
    <h2 class="mt-5">or</h2>
    <%= link_to "Suggest an event", new_event_path, class: "btn-lg btn-primary mt-2 mb-5" %>
  <% else %>

<h1 class="py-3">Search events:</h1>

  <%= render partial: "filters" %>

  <div class="calendar-location mt-3" id="calendar-top"><%= current_user.search_location %></div>
  <%= render partial: "calendar", locals: { events: @events } %>
  <div class="my-2"></div>

<%= form_tag "#calendar-top", method: :get, class: "d-flex" do %>
   <%= text_field_tag :query,
                  params[:query],
                  class: "form-control",
                  placeholder: "Search by keyword" %>
                <%= submit_tag "Search", class: "btn btn-primary mb-3" %>
              <% end %>

  <% if @events.length > 0 %>
    <% if @search_results.length == 0 && params[:query] != "" && params[:query] != nil%>
      <p>No results for "<%= params[:query] %>"</p>
    <% end %>
    <% if @search_results.length > 0 && params[:query] != "" && params[:query] != nil%>
      <h2 class="mt-5">Search results:</h2>
        <% @search_results.each do |event|  %>
          <%= render partial: "event_card", locals: { event: event } %>
        <% end %>
    <% end %>
    <h2 class="mt-5">Closest to you:</h2>
    <div class="d-flex flex-column-reverse">
      <% @events.each do |event|  %>
        <%= render partial: "event_card", locals: { event: event } %>
      <% end %>
    </div>
  <% end %>
  <% end %>
</div>
