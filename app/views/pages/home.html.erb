<%= link_to welcome_path, class: "back-button" do %>
  <i class="fas fa-arrow-left"></i>
<% end %>
<h1 class="page-title">BUDDY</h1>

<div class="container">
<h1 class="py-3">Search events:</h1>

  <% if @events.length == 0 %>
    <p class="py-5">No events listed for "<%= current_user.search_location %>"</p>
  <% end %>

  <div class="d-flex">
    <span class="filter" style="background-color: <%= Category.find_by(name: "outdoors").color %>">outdoors</span>
    <span class="filter" style="background-color: <%= Category.find_by(name: "live music").color %>">live music</span>
    <span class="filter" style="background-color: <%= Category.find_by(name: "food").color %>">food</span>
    <span class="filter" style="background-color: <%= Category.find_by(name: "drinks").color %>">drinks</span>
  </div>
  <div class="d-flex">
    <span class="filter" style="background-color: <%= Category.find_by(name: "sports").color %>">sports</span>
    <span class="filter" style="background-color: <%= Category.find_by(name: "theater").color %>">theater</span>
    <span class="filter" style="background-color: <%= Category.find_by(name: "festival").color %>">festival</span>
    <span class="filter" style="background-color: <%= Category.find_by(name: "other").color %>">other</span>
  </div>
  <div class="calendar-location mt-3" id="calendar-top"><%= current_user.search_location %></div>
  <%= render partial: "calendar", locals: { events: @events } %>
  <div class="my-2"></div>

<%= form_tag "#calendar-top", method: :get, class: "d-flex" do %>
   <%= text_field_tag :query,
                  params[:query],
                  class: "form-control",
                  placeholder: "Search by keyword" %>
                <%= submit_tag "Search", class: "btn btn-primary mb-3" %>
              <% end %>

  <% if @events.length > 0 %>
    <% if @search_results.length == 0 && params[:query] != "" && params[:query] != nil%>
      <p>No results for "<%= params[:query] %>"</p>
    <% end %>
    <% if @search_results.length > 0 && params[:query] != "" && params[:query] != nil%>
      <h2 class="mt-5">Search results:</h2>
      <div class="d-flex flex-column-reverse">
        <% @search_results.each do |event|  %>
          <%#= event.created_at.to_formatted_s(:short): <%= event.message %>
          <%= link_to event_path(event) do %>

          <div class="card d-flex flex-row m-2 shadow">
            <div style="max-width: 350px; max-height: 300px;">
              <%= cl_image_tag event.photo.key, crop: :fill, class:"card-img" %>
            </div>

            <div class="m-3">
              <p><%= event.name  %></p>
            <% end %>
              <p><%= event.date_time.strftime("%m/%d/%Y") %></p>
              <p><%= event.date_time.strftime("%I:%M%p") %></p>
              <p><%= event.address %></p>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    <h2 class="mt-5">Closest to you:</h2>
    <div class="d-flex flex-column-reverse">
      <% @events.each do |event|  %>
        <%#= event.created_at.to_formatted_s(:short): <%= event.message %>
        <%= link_to event_path(event) do %>

        <div class="card d-flex flex-row m-2 shadow">
          <div style="max-width: 350px; max-height: 300px;">
            <%= cl_image_tag event.photo.key, crop: :fill, class:"card-img" %>
          </div>

          <div class="m-3">
            <p><%= event.name  %></p>
          <% end %>
            <p><%= event.date_time.strftime("%m/%d/%Y") %></p>
            <p><%= event.date_time.strftime("%I:%M%p") %></p>
            <p><%= event.address %></p>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
