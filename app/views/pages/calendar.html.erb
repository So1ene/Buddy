<%= link_to root_path, class: "back-button" do %>
  <i class="fas fa-arrow-left"></i>
<% end %>
<h1 class="page-title">BUDDY</h1>
<div class="container">

<div class="w-100">
<h1 class="title py-3" style="font-size: 32px"><strong>Your upcoming events</strong></h1>
</div>

  <% if @events.length == 0 && params[:categories].nil?%>
    <p>You don't have any planned events!</p>
    <%= link_to "Search for a buddy", welcome_path, class: "btn btn-primary" %>
  <% else %>
    <%= render partial: "filters" %>
    <div class="pt-1"></div>
    <%= render partial: "calendar", locals: { events: @events } %>
    <div class="p-2">

    <div class="d-flex mt-4 flex-column-reverse">
      <% @events.each do |event|  %>

        <div class="card-product">
          <% if event.user == current_user%>
            <%= link_to new_message_path(event.requests.find_by(status:"Accepted").user, event: event) do %>
              <%=  cl_image_tag url_for(event.photo), height: 300, width: 400, crop: :fill %>
            <% end %>
          <% else %>
            <%= link_to new_message_path(event.user, event: event) do %>
              <%=  cl_image_tag url_for(event.photo), height: 300, width: 400, crop: :fill %>
            <% end %>
          <% end %>
          <div class="flex-column">
            <ul class="card-product-infos">
              <% if event.user == current_user%>
                <%= link_to new_message_path(event.requests.find_by(status:"Accepted").user, event: event) do %>
                  <li><h2 style="margin: 0"><%= event.name %></h2></li>
                <% end %>
              <% else %>
                <%= link_to new_message_path(event.user, event: event) do %>
                  <li><h2 style="margin: 0"><%= event.name %></h2></li>
                <% end %>
              <% end %>
              <li><%= event.address %></li>
              <li style="color:gray; font-size: 16px, margin: 0"><%= event.date_time.strftime("%m/%d/%Y") %> - <%= event.date_time.strftime("%I:%M%p") %></li>
            </ul>
            <div class="d-flex">
              <% unless event.categories.first.nil? %>
                <span class="card-filter ml-2" style="background-color: <%= event.categories.first.color %>"><%= event.categories.first.name %></span>
              <% end %>
              <% unless event.categories.second.nil? %>
                <span class="card-filter" style="background-color: <%= event.categories.second.color %>"><%= event.categories.second.name %></span>
              <% end %>
              <% unless event.categories.third.nil? %>
                <span class="card-filter" style="background-color: <%= event.categories.third.color %>"><%= event.categories.third.name %></span>
              <% end %>
            </div>
              <div>
                  <%= cl_image_tag(event.requests.find_by(status:"Accepted").user.photo.key, class: "card-avatar") %>
                  <%= cl_image_tag(event.user.photo.key, class: "card-avatar", style: "right: 50px;") %>
              </div>
          </div>
        </div>

      <% end %>
    </div>
  </div>
<% end %>
